<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title></title>
    @import "../include/header.inc";
</head>
<body ontouchstart>
<div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>
<div class="container" id="container"></div>

<!--频道页面-->
<link rel="import" href="../../../pages/home/tenantList.html">

<!--模版-->
<!--一级分类-->
<link rel="import" href="../../../model/templete/home/tenantList/classOne.html">
<!--二级分类-->
<link rel="import" href="../../../model/templete/home/tenantList/classTwo.html">
<!--商家列表-->
<link rel="import" href="../../../model/templete/home/tenantList/tenantList.html">

@import "../../../model/widget/include/toast.html";
@import "../../../model/widget/include/dialog.html";
<script src="/weixin/js/common.min.js"></script>
<script src="/weixin/js/wap.min.js"></script>
<script type="text/javascript">
    $(function () {
        pageManager.show("tenantList");

        //一级分类
        var tu = new tenant(function (data) {
            var h = render.fill($("#tpl_classOne"), data);
            $(".find_nav").append(h);
            console.log(h);
            nav();
//            //默认第一次加载
            $('#pagenavi1 li').first().addClass('find_nav_cur');
            var oneId = $('.find_nav_cur').attr('data-id');
//          二级分类
            var dh = new tenant(function (data) {
                var h = render.fill($("#tpl_classTwo"), data);
                $(".tenant_tap").append(h);
                $('.tenant_tap span').first().addClass('active');
//                默认加载第一个
                if($('.tenant_tap span').first().hasClass('active') == true){
                    shuju();
                }
            });
            dh.classTwo({superiorId:oneId});
        });
        tu.classOne({});


        //顶部导航点击事件
        $(document).on('click', ".find_nav_list li", function () {
            var channelId = $(this).attr('data-id');
            $('.pageable-down').remove();
            $(".pageable .tenant_list").html('');

            //定位，获取经纬度
            var pge = null;
            weixin.location(function () {
                var td = new tenant(function (data) {
                    var h = render.fill($("#tpl_tenantList"), data);
                    $(".pageable .tenant_list").append(h);
                });
                td.list({
                    channelId: pageManager.GetQueryString("id"),
                    tenantCategoryId: channelId,
                    lat: weixin.lat,
                    lng: weixin.lng
                });
            });
        });


        function shuju() {
            //定位，获取经纬度
            weixin.location(function () {
                var td = new tenant(function (data) {
                    var h = render.fill($("#tpl_recommendTenant"), data);
                    $(".pageable .tenant_list").append(h);
                });
                td.list({
                    channelId: pageManager.GetQueryString("id"),
                    lat: weixin.lat,
                    lng: weixin.lng
                });
            });
        }
    })
</script>

</body>
</html>



