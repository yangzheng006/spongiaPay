<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>提交资料</title>
    @import "../include/header.inc";
</head>
<body ontouchstart>
<div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>
<div class="container" id="container"></div>
<link rel="import" href="../../../pages/member/invite.html">

@import "../../../model/widget/include/toast.html";
@import "../../../model/widget/include/dialog.html";
<script src="/weixin/js/common.min.js"></script>
<script src="/weixin/js/wap.min.js"></script>
<script type="text/javascript">
    $(function () {
        pageManager.show("invite");

        $(document).on('click', '.financeTab-tabTop>div', function () {
            var index = $(this).index(), that = this;
            console.log(index);
            $('.addContent .addContentList').eq(index).show().siblings().hide()
            if ($(this).hasClass('active')) {
                return false;
            }
            $(this).addClass('active').siblings('.active').removeClass('active');
        })



        $(document).on('click', '.toggleShowDetail', function () {
            $('.showDetailForm').toggle();
            if ($(this).find('.weui-cell__ft i').hasClass('icon-up')) {
                $(this).find('.weui-cell__ft i').removeClass('icon-up').addClass('icon-arrowbottom')
            } else {
                $(this).find('.weui-cell__ft i').removeClass('icon-arrowbottom').addClass('icon-up')
            }
        })
        var shId;
        //填写第一步资料
        var bbusinessLicense,identityCardFront,identityCardBack,Authorizationletter,placeofBusiness;
        $(document).on('click','.recommend .goSubmit',function () {
            var tenantName=$('.recommend .tenantName').val();
            var linkMan=$('.recommend .linkMan').val();
            var phone=$('.recommend .phone').val();

            var accounType='normal';
            var bussinessNumber=$('.recommend .bussinessNumber').val();
            var identityCardNum=$('.recommend .identityCardNum').val();
            var account=$('.recommend .account').val();
            var bank=$('.recommend .bank').val();
            var bankAccount=$('.recommend .bankAccount').val();

            if(!tenantName){
                toast.show('请输入商家名称',1000)
            }else if(!linkMan){
                toast.show('请输入联系人',1000)
            }else if(!(/^1[0-9]{10}$/.test(phone))){
                toast.show('请输入正确联系电话',1000)
            }else if(!bbusinessLicense && !identityCardFront &&!identityCardBack && !Authorizationletter &&!placeofBusiness && !bussinessNumber &&!identityCardNum &&!account &&!bank &&!bankAccount){
                new authentication(function (data) {
                    shId=data.id;
                    toast.show('提交成功',1000)
                }).merchantCA({
                    tenantName:tenantName,
                    linkMan:linkMan,
                    phone:phone,
                    hyId:memberId
                })
            }else if(!bussinessNumber){
                toast.show('请填写营业执照号',1000)
            }else if(!bbusinessLicense){
                toast.show('请上传营业执照照片',1000)
            }else if(!identityCardNum){
                toast.show('请填写身份证号',1000)
            }else if(!identityCardFront){
                toast.show('请上传身份证正面照片',1000)
            }else if(!identityCardBack){
                toast.show('请上传身份证反面照片',1000)
            }else if(!account){
                toast.show('请填写开户名',1000)
            }else if(!bank){
                toast.show('请填写开户行',1000)
            }else if(!bankAccount){
                toast.show('请填写银行账户',1000)
            }else if(!Authorizationletter){
                toast.show('请上传授权书照片',1000)
            }else if(!placeofBusiness){
                toast.show('请上传营业场所照片',1000)
            }else{
                new authentication(function (data) {
                    shId=data.id;
                    new authentication(function (data) {
                        dialog.show('提交资料成功',function () {
                            location.reload();
                        })
                    }).tanantsAuthoBusinessLicense({
                        bussinessNumber:bussinessNumber,
                        bbusinessLicense:bbusinessLicense,
                        identityCardNum:identityCardNum,
                        identityCardFront:identityCardFront,
                        identityCardBack:identityCardBack,
                        accounType:accounType,
                        account:account,
                        bank:bank,
                        bankAccount:bankAccount,
                        Authorizationletter:Authorizationletter,
                        placeofBusiness:placeofBusiness,
                        shId:shId
                    })
                }).merchantCA({
                    tenantName:tenantName,
                    linkMan:linkMan,
                    phone:phone,
                    hyId:memberId
                })

            }
        });


        $("#bbusinessLicense").on('change', function (e) {
            toast.loadingSelf(1000000, '压缩上传中');
            compressImg(e.target.files[0], function (file) {
                new common(function (data) {
                    toast.closeLoading();
                    bbusinessLicense = data.tpname;
                    $("#bbusinessLicenseImg")[0].src = file;
                }).uploadImage({
                    image: file.substring(file.indexOf(",") + 1),
                    type: 2
                })
            })
        });
        $("#identityCardFront").on('change', function (e) {
            toast.loadingSelf(1000000, '压缩上传中');
            compressImg(e.target.files[0], function (file) {
                new common(function (data) {
                    toast.closeLoading();
                    identityCardFront = data.tpname;
                    $("#identityCardFrontImg")[0].src = file;
                }).uploadImage({
                    image: file.substring(file.indexOf(",") + 1),
                    type: 2
                })
            })
        });
        $("#identityCardBack").on('change', function (e) {
            toast.loadingSelf(1000000, '压缩上传中');
            compressImg(e.target.files[0], function (file) {
                new common(function (data) {
                    toast.closeLoading();
                    identityCardBack = data.tpname;
                    $("#identityCardBackImg")[0].src = file;
                }).uploadImage({
                    image: file.substring(file.indexOf(",") + 1),
                    type: 2
                })
            })
        });
        $("#Authorizationletter").on('change', function (e) {
            toast.loadingSelf(1000000, '压缩上传中');
            compressImg(e.target.files[0], function (file) {
                new common(function (data) {
                    toast.closeLoading();
                    Authorizationletter = data.tpname;
                    $("#AuthorizationletterImg")[0].src = file;
                }).uploadImage({
                    image: file.substring(file.indexOf(",") + 1),
                    type: 2
                })
            })
        });
        $("#placeofBusiness").on('change', function (e) {
            toast.loadingSelf(1000000, '压缩上传中');
            compressImg(e.target.files[0], function (file) {
                new common(function (data) {
                    toast.closeLoading();
                    placeofBusiness = data.tpname;
                    $("#placeofBusinessImg")[0].src = file;
                }).uploadImage({
                    image: file.substring(file.indexOf(",") + 1),
                    type: 2
                })
            })
        });


        //选择账号类型（对工/法人）
        $(document).on('click','.selsectAccounType .weui-check__label', function () {
            var accType=$(this).attr('accType');
            accounType=accType;
        });




        var countdown = 60;
        var canSend=true;
        function settime(val) {
            if (countdown == 0) {
                canSend=true;
                val.innerHTML="发送验证码";
                val.style.color="#3782d9";
                countdown = 60;
                return;
            } else {
                canSend=false;
                val.innerHTML="重新发送(" + countdown + ")";
                val.style.color="#999";
                countdown--;
            }
            setTimeout(function() {
                settime(val)
            },1000)
        }
        //发送验证码
        $(document).on('click','.sendLoginCode',function () {
            if(canSend){
                var $this=this;
                //手机号校验
                var phoneNumber = $('.loginIndex .phoneNumber').val();
                if(!(/^1[0-9]{10}$/.test(phoneNumber))){
                    toast.show('请输入正确手机号',1000);
                    return false;
                }else{
                    new login(function (data) {
                        console.log(data);
                        settime($this);
                        canSend=false;
                    }).sendLoginCode({
                        phoneNumber:phoneNumber,
                        type:0
                    })
                }
            }
        });

        //注册提交
        $(document).on('click','.goRegister',function () {
            var phoneNumber = $('.loginIndex .phoneNumber').val();
            var code=$('.loginIndex .code').val();
            var password=$('.loginIndex .password').val();
            var passwordConfirm=$('.loginIndex .passwordConfirm').val();
            if(!phoneNumber){
                toast.show('请输入手机号',1000)
            }else if(!code){
                toast.show('请输入验证码',1000)
            }else if(password=='' || passwordConfirm==''){
                toast.show('密码不能为空','1000')
            }else if(password!=passwordConfirm){
                toast.show('两次密码不一致','1000')
            }else{
                //注册提交
                new login(function (data) {
                    console.log(data);
                    dialog.show('注册成功，立即登陆',function () {
                        location.replace('../login/index.html')
                    })
                }).register({
                    account:phoneNumber,
                    authoCode:code,
                    passwd:passwordConfirm
                })
            }

        })


    });
</script>
</body>
</html>

